{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto py-10" id="tool-container">
    
    <!-- Header -->
    <div class="text-center mb-10" data-aos="fade-down">
        <h1 class="text-4xl font-serif text-white">CodyMailz<span class="text-gold">.AI</span></h1>
        <p class="text-gray-500 text-xs uppercase tracking-widest mt-2">Engineered by Lawrence Oladeji</p>
    </div>

    <!-- Generator Form -->
    <div class="glass-panel p-8 rounded-xl relative z-10 max-w-4xl mx-auto border-t-4 border-gold" data-aos="fade-up">
        <form action="/generate" method="post" class="space-y-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Target Profile</label>
                    <input type="text" name="target" value="{{ target }}" placeholder="e.g. Head of Data at Fintech Co." required
                           class="w-full bg-black/50 border border-gray-700 text-white p-4 rounded focus:border-gold outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Your Offer/Goal</label>
                    <input type="text" name="service" value="{{ service }}" placeholder="e.g. Build an AI Agent for Ops" required
                           class="w-full bg-black/50 border border-gray-700 text-white p-4 rounded focus:border-gold outline-none transition-colors">
                </div>
            </div>
            
            <!-- Context -->
            <div>
                <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Intelligence / Context</label>
                <textarea name="source" rows="2" placeholder="Paste a LinkedIn post, company news, or pain point..." required
                          class="w-full bg-black/50 border border-gray-700 text-white p-4 rounded focus:border-gold outline-none transition-colors">{{ source }}</textarea>
            </div>

            <!-- Strategy Selector -->
            <div>
                <label class="block text-xs uppercase tracking-widest text-gray-500 mb-3">Email Strategy</label>
                <div class="grid grid-cols-2 gap-4">
                    <label class="cursor-pointer">
                        <input type="radio" name="length" value="Short & Punchy (Sniper)" class="peer sr-only" {% if length == 'Short & Punchy (Sniper)' or not length %}checked{% endif %}>
                        <div class="p-3 border border-gray-700 rounded text-center text-gray-400 peer-checked:border-gold peer-checked:text-gold peer-checked:bg-gold/10 transition">
                            ‚ö° Short & Punchy (Sniper)
                        </div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="length" value="Value & Insight (Long)" class="peer sr-only" {% if length == 'Value & Insight (Long)' %}checked{% endif %}>
                        <div class="p-3 border border-gray-700 rounded text-center text-gray-400 peer-checked:border-gold peer-checked:text-gold peer-checked:bg-gold/10 transition">
                            üìä Value & Insight (Long)
                        </div>
                    </label>
                </div>
            </div>

            <button type="submit" class="w-full bg-gold text-black font-bold uppercase tracking-widest py-4 hover:bg-white transition duration-300 shadow-lg hover:shadow-gold/20 mt-4">
                Generate Protocols
            </button>
        </form>
    </div>

    <!-- Result Section (Only shows if result exists) -->
    {% if result %}
    <div id="result-section" class="mt-16 pt-8 border-t border-gray-800 animate-fade-in-up">
        <h3 class="text-white font-serif text-2xl text-center mb-8">Outreach Variations</h3>
        
        <div class="grid md:grid-cols-2 gap-8">
            
            <!-- OPTION A -->
            <div class="glass-panel p-6 rounded-xl border border-gray-700 hover:border-gold transition duration-500 group relative">
                <div class="absolute -top-3 left-6 bg-black px-2 border border-gold/30 text-gold text-xs uppercase tracking-widest">
                    Option A: {{ result.style_a }}
                </div>
                
                <div class="mb-4 mt-2">
                    <span class="text-gray-500 text-xs uppercase">Subject:</span>
                    <p class="text-white font-mono text-sm border-b border-gray-800 pb-2">{{ result.subject_a }}</p>
                </div>

                <pre id="email-a" class="text-gray-300 whitespace-pre-wrap font-sans text-sm leading-relaxed mb-10">{{ result.body_a }}</pre>
                
                <button onclick="copyToClip('email-a')" class="absolute bottom-4 right-4 bg-gray-800 text-gray-400 text-xs uppercase tracking-widest px-4 py-2 rounded hover:bg-gold hover:text-black transition">
                    Copy A
                </button>
            </div>

            <!-- OPTION B -->
            <div class="glass-panel p-6 rounded-xl border border-gray-700 hover:border-cyan-400 transition duration-500 group relative">
                <div class="absolute -top-3 left-6 bg-black px-2 border border-cyan-500/30 text-cyan-400 text-xs uppercase tracking-widest">
                    Option B: {{ result.style_b }}
                </div>
                
                <div class="mb-4 mt-2">
                    <span class="text-gray-500 text-xs uppercase">Subject:</span>
                    <p class="text-white font-mono text-sm border-b border-gray-800 pb-2">{{ result.subject_b }}</p>
                </div>

                <pre id="email-b" class="text-gray-300 whitespace-pre-wrap font-sans text-sm leading-relaxed mb-10">{{ result.body_b }}</pre>
                
                <button onclick="copyToClip('email-b')" class="absolute bottom-4 right-4 bg-gray-800 text-gray-400 text-xs uppercase tracking-widest px-4 py-2 rounded hover:bg-cyan-400 hover:text-black transition">
                    Copy B
                </button>
            </div>

        </div>

        <!-- FEEDBACK BUTTON (Only shows if result exists) -->
        <div class="text-center mt-12 mb-8">
            <p class="text-gray-500 text-xs uppercase tracking-widest mb-4">Was this helpful?</p>
            <button id="likeBtn" onclick="sendLike()" class="group bg-gray-900 border border-gray-700 text-gray-400 px-6 py-3 rounded-full hover:border-green-500 hover:text-green-500 transition-all flex items-center gap-2 mx-auto">
                <span class="text-lg group-hover:scale-125 transition-transform">üëç</span> 
                <span class="font-bold text-xs uppercase tracking-widest">Approve</span>
            </button>
        </div>

    </div>

    <script>
        document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });

        function copyToClip(id) {
            const text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied to clipboard!");
            });
        }

        function sendLike() {
            const btn = document.getElementById('likeBtn');
            
            // Prevent double clicking
            if(btn.classList.contains('border-green-500')) return;

            fetch('/like', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                // Visual Update
                btn.classList.remove('border-gray-700', 'text-gray-400');
                btn.classList.add('border-green-500', 'text-green-500', 'bg-green-500/10');
                btn.innerHTML = `<span class="text-lg">‚úÖ</span> <span class="font-bold text-xs uppercase tracking-widest">Recorded</span>`;
            })
            .catch(err => console.log(err));
        }
    </script>
    {% endif %}
</div>
{% endblock %}